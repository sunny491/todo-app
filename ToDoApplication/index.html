<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>To-Do App</title>
    <style>
        body { font-family: Arial; max-width: 650px; margin: 40px auto; background: #f6f6f6; padding: 20px; border-radius: 10px; transition: 0.3s; }
        body.dark { background: #1e1e1e; color: white; }
        h2 { text-align: center; }
        #taskInput { width: 65%; padding: 10px; margin-right: 10px; }
        button { padding: 10px 15px; cursor: pointer; margin: 3px; }
        .task { display: flex; justify-content: space-between; padding: 10px; margin: 5px 0; background: white; border-radius: 5px; }
        body.dark .task { background: #2c2c2c; color: white; }
        .completed { text-decoration: line-through; color: green; }
        #counts { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
<h2>To-Do Application</h2>
<button onclick="toggleDark()">Dark Mode</button><br><br>
<input type="text" id="taskInput" placeholder="Enter task..." />
<button onclick="addTask()">Add</button>
<div id="counts"></div>
<div id="taskList"></div>

<script>
    const API_URL = "http://localhost:8080/api/todos";
    let allTasks = [];

    async function loadTasks() {
        const res = await fetch(API_URL);
        allTasks = await res.json();
        renderTasks();
    }

    function renderTasks() {
        const list = document.getElementById("taskList");
        list.innerHTML = "";
        allTasks.forEach(task => {
            const div = document.createElement("div");
            div.className = "task";
            div.innerHTML = `
                <span class="${task.completed ? 'completed' : ''}">${task.title}</span>
                <div>
                    <button onclick="toggleComplete(${task.id}, ${task.completed})">${task.completed ? 'Undo' : 'Done'}</button>
                    <button onclick="editTask(${task.id}, '${task.title.replace(/'/g, "\\'")}')">Edit</button>
                    <button onclick="deleteTask(${task.id})" style="color:red">Delete</button>
                </div>
            `;
            list.appendChild(div);
        });
        updateCounts();
    }

    async function addTask() {
        const title = document.getElementById("taskInput").value.trim();
        if (!title) return;
        await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title, completed: false })
        });
        document.getElementById("taskInput").value = "";
        loadTasks();
    }

    async function toggleComplete(id, completed) {
        await fetch(`${API_URL}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ completed: !completed })
        });
        loadTasks();
    }

    async function editTask(id, oldTitle) {
        const newTitle = prompt("Edit task:", oldTitle);
        if (!newTitle || !newTitle.trim()) return;
        await fetch(`${API_URL}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title: newTitle })
        });
        loadTasks();
    }

    async function deleteTask(id) {
        await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        loadTasks();
    }

    function toggleDark() { document.body.classList.toggle("dark"); }

    function updateCounts() {
        const total = allTasks.length;
        const completed = allTasks.filter(t => t.completed).length;
        const pending = total - completed;
        document.getElementById("counts").innerText = `Total: ${total} | Completed: ${completed} | Pending: ${pending}`;
    }

    loadTasks();
</script>
</body>
</html>